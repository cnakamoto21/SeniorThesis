# SeniorThesis
Identifying New Loci Associated with Antibiotic Resistance in Bacterial Genomes Through the Use of Multiple Species in Genome-Wide Association Studies

This github contains all of the code that is necessary to reproduce my senior thesis. 

## Pre-Processing

In the order in which they should be run, the scripts in this folder, briefly described, are
1) Genome_Identifier.py, lightly adapted from code from Luca Freschi, can be called in the PATRIC command line interface to generate a table with information from that database for each species of interest on all the isolates with relevant antibiotic resistance information. 
2) Genome_list_maker.py, which cleans the table file from Genome_Identifier.py with antibiotic resistance information and genome IDs. 
3) Genome_downloader.py, which downloads the whole genome sequences for the in the table from Genome_list_maker.py from PATRIC. 
4) Prokker.py, which calls prokka on all of the downloaded genomes using slurm command prokka.sh. 
5) FAA_mover.py, which copies all of the amino acid sequence FAA files generated by prokka into a folder. 
6) Protein_Combiner.py, which extracts the sequences of the proteins of interest from the whole proteome FAA files and combines them into FAA files with all the amino acid sequences from all isolates for each protein. 
7) Aligner.sh, which calls MUSCLE to align the combined protein sequence files from Protein_Combiner.py. 
These output amino acid sequence alignment files are then used by the analysis files. 

This folder also has a sub-folder "alt-GRMs" for generating GRMs from whole genome sequence data. The files in this folder can be broken down into the three methods for whole-genome GRM construction. 
Method 1: Core genome alignment (for S. enterica and S. aureus)
1) gff_copier_gen.py, which copies all of the prokka-generated GFF files into a separate folder for access. 
2) gff_copier_subset.py, which copies all of the GFF files from the folder created by gff_copier_gen.py into individual folders for each species. 
3) roary_mini.sh, which contains a slurm command to run roary to generate whole core genome alignments. 
4) bi_raw_from_afa.py, which converts the core genome alignment files into binary variant matrices. 

Method 2: FastANI approximate genetic identity scores (for E. coli)
1) fastani-er.py, which calls fastani-er.sh, which itself calls fastani-subset.py in order to call FastANI for all pairs of E. coli isolates in the dataset. 
2) ec_grm_maker.py, which parses through the FastANI outputs and assembles them into a raw GRM numpy file. 

Method 3: Utilize Lab data (for M. tuberculosis) 
1) TB_lab_biosample_finder.py, written by Anna G. Green, which finds the isolates in my dataset that are in the lab's variant matrix. 
2) TB_lab_data_subsetter.py, wwritten by Anna G. Green, which returns a numpy variant matrix with the isolates in my dataset and the lab's variant matrix. 
3) bi_raw_from_anna.py, which converts the lab variant matrix into a binary variant matrix. 

Additionally, there is more code in this folder that is useful for multiple methods. 
1) grm_raw_from_bi.py, which applies to methods 1 and 3 and transforms the binary variant matrix into a raw GRM numpy file. 
2) new_genome_table_maker.py, which makes a new CSV of isolates without the isolates that had to be dropped to generate the species GRMs. 
3) GRM_subsetter.py, which subsets and, in some cases, reorders the raw GRMs to produce txt GRM files for the isolates in the LMM analyses. 

## analysis

There are two files in analysis: 
1) Simple.py, which runs the simple single-gene, species-level-controlled logistic regressions and outputs results tables and figures. 
2) Multi-Gene-PC.py, which runs the multi-gene, PC-controlled logistic regressions and outputs results tables and figures. 

Additionally, there are two folders with the code to run the other analyses. 
The LMM_intermediates folder contains the following scripts, in the order in which they should be run: 
1) LMM_GRMvary.py, which generates all gemma input files for classic, dropsite, and genedrop all-species analyses. 
2) gemmer_vary.py, which calls gemma to run the classic, dropsite, and genedrop all-species analyses. 
3) LMM_vary_analysis.py, which generates the results tables and figures from the gemma output results. 
4) LMM_genedrop.py, which generates the gemma input files for genedrop analyses of all of the species and the all-species.
5) gemmer_genedrop.py, which calls gemma to run all of the genedrop analyses.  
6) LMM_genedrop_analysis, which generates the results tables and figures from the genedrop gemma output results. 

The LMM_final folder contains the following scripts, in the order in which they should be run: 
1) LMM_final.py, which generates all gemma input files except for the GRMs for the whole genome controlled analyses. 
2) gemmer_final.py, which calls gemma to run the whole genome controlled analyses. 
3) LMM_final_analysis.py, which generates the results tables and figures from the gemma output results. 

Note that the code sometimes might require that folders be created, file names be changed, or that files be moved between folders. Other modifications may be necessary to run the code in a different setting. 
